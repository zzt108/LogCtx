<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      throwConfigExceptions="true">

  <!-- Variables for configuration -->
  <variable name="seqUrl" value="http://localhost:5341" />
  <variable name="seqApiKey" value="" />

  <!-- Targets for logging -->
  <targets async="true">

    <!-- Console target for local debugging -->
    <target xsi:type="Console"
            name="console"
            layout="${longdate}|${level:uppercase=true}|${logger}|${message}${onexception:inner=${newline}${exception:format=tostring}}" />

    <!-- File target for persistent logs -->
    <target xsi:type="File"
            name="file"
            fileName="${basedir}/logs/app.log"
            archiveFileName="${basedir}/logs/archives/app.{#}.log"
            archiveEvery="Day"
            archiveNumbering="Date"
            maxArchiveFiles="7"
            layout="${longdate}|${level:uppercase=true}|${logger}|${message}${onexception:inner=${newline}${exception:format=tostring}}" />

    <!-- SEQ target for structured logging -->
    <target xsi:type="Seq"
            name="seq"
            serverUrl="${var:seqUrl}"
            apiKey="${var:seqApiKey}">

      <!-- Capture all scope properties (BeginScope dictionary) -->
      <property name="MachineName" value="${machinename}" />
      <property name="ProcessId" value="${processid}" />
      <property name="ThreadId" value="${threadid}" />

      <!-- BeginScope properties are automatically captured -->
      <!-- Props dictionary entries will appear as structured properties in SEQ -->
    </target>
  </targets>

  <!-- Logging rules -->
  <rules>
    <!-- Write all logs to console (Debug and above) -->
    <logger name="*" minlevel="Debug" writeTo="console" />
    <!-- Write all logs to file (Info and above) -->

    <logger name="*" minlevel="Info" writeTo="file" />
    <!-- Write all logs to SEQ (Trace and above for full visibility) -->

    <logger name="*" minlevel="Trace" writeTo="seq" />
  </rules>
</nlog>